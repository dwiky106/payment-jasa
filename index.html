<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pembayaran Dwi Karya Inovasi Teknologi</title>

<script 
  src="https://app.sandbox.midtrans.com/snap/snap.js"
  data-client-key="Mid-client-BsF-Y3p_pWQLwBYF">
</script>

<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #2e7dff, #6fa4ff);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  margin: 0;
}

.card {
  background: white;
  padding: 35px;
  border-radius: 18px;
  width: 360px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.15);
}

h3 {
  text-align: center;
  margin-bottom: 20px;
}

input {
  width: 100%;
  padding: 12px;
  margin: 8px 0;
  border-radius: 8px;
  border: 1px solid #ddd;
  font-size: 14px;
}

input:focus {
  outline: none;
  border-color: #2e7dff;
}

button {
  width: 100%;
  padding: 14px;
  background: #2e7dff;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
  margin-top: 10px;
  transition: 0.3s;
}

button:hover {
  background: #1b5fd6;
}

button:disabled {
  background: #999;
  cursor: not-allowed;
}

/* MODAL */

.modal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  justify-content: center;
  align-items: center;
}

.modal-content {
  background: white;
  padding: 30px;
  border-radius: 18px;
  text-align: center;
  width: 320px;
  animation: fadeIn 0.3s ease;
}

.modal-content h2 {
  margin-top: 15px;
}

.modal-content button {
  margin-top: 20px;
}

.icon {
  display: none;
  margin: auto;
  width: 80px;
  height: 80px;
}

.success-icon svg { stroke: #28a745; }
.error-icon svg { stroke: #dc3545; }

.circle {
  stroke-width: 3;
  stroke-dasharray: 157;
  stroke-dashoffset: 157;
  animation: stroke 0.6s forwards;
}

.check, .line {
  stroke-width: 3;
  stroke-dasharray: 50;
  stroke-dashoffset: 50;
  animation: stroke 0.4s 0.6s forwards;
}

@keyframes stroke {
  to { stroke-dashoffset: 0; }
}

@keyframes fadeIn {
  from { transform: scale(0.8); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}
</style>
</head>

<body>

<div class="card">
  <h3>Pembayaran Mitra DWI KARYA INOVASI TEKNOLOGI</h3>

  <input type="text" id="name" placeholder="Nama Lengkap">
  <input type="email" id="email" placeholder="Email Aktif">
  <input type="text" id="service" placeholder="Deskripsi Jasa">
  <input type="number" id="amount" placeholder="Nominal (min 10000)">

  <button id="payBtn" onclick="pay()">Bayar Sekarang</button>
</div>

<!-- MODAL -->
<div id="paymentModal" class="modal">
  <div class="modal-content">
    <div class="icon success-icon">
      <svg viewBox="0 0 52 52">
        <circle class="circle" cx="26" cy="26" r="25" fill="none"/>
        <path class="check" fill="none" d="M14 27l7 7 16-16"/>
      </svg>
    </div>

    <div class="icon error-icon">
      <svg viewBox="0 0 52 52">
        <circle class="circle" cx="26" cy="26" r="25" fill="none"/>
        <line class="line" x1="16" y1="16" x2="36" y2="36"/>
        <line class="line" x1="36" y1="16" x2="16" y2="36"/>
      </svg>
    </div>

    <h2 id="modalTitle"></h2>
    <p id="modalMessage"></p>
    <button onclick="closeModal()">Tutup</button>
  </div>
</div>

<script>
function showModal(type, title, message) {
  const modal = document.getElementById("paymentModal");
  document.querySelector(".success-icon").style.display = "none";
  document.querySelector(".error-icon").style.display = "none";

  if (type === "success") {
    document.querySelector(".success-icon").style.display = "block";
  } else {
    document.querySelector(".error-icon").style.display = "block";
  }

  document.getElementById("modalTitle").innerText = title;
  document.getElementById("modalMessage").innerText = message;

  modal.style.display = "flex";
}

function closeModal() {
  document.getElementById("paymentModal").style.display = "none";
}

async function pay() {
  const btn = document.getElementById("payBtn");
  btn.disabled = true;
  btn.innerText = "Memproses...";

  const data = {
    name: document.getElementById('name').value,
    email: document.getElementById('email').value,
    service: document.getElementById('service').value,
    amount: document.getElementById('amount').value
  };

  if (!data.name || !data.email || !data.service || data.amount < 10000) {
    showModal("error", "Data Tidak Valid", "Harap isi semua data dengan benar.");
    btn.disabled = false;
    btn.innerText = "Bayar Sekarang";
    return;
  }

  const response = await fetch('https://midtrans-backend-production.up.railway.app/create-transaction', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  });

  const result = await response.json();

  btn.disabled = false;
  btn.innerText = "Bayar Sekarang";

  if (result.token) {
    snap.pay(result.token, {
      onSuccess: function() {
        showModal("success", "Pembayaran Berhasil", "Terima kasih, pembayaran Anda telah diproses.");
      },
      onPending: function() {
        showModal("error", "Menunggu Pembayaran", "Silakan selesaikan pembayaran sebelum waktu habis.");
      },
      onError: function() {
        showModal("error", "Pembayaran Gagal", "Terjadi kesalahan saat memproses pembayaran.");
      },
      onClose: function() {
        showModal("error", "Pembayaran Dibatalkan", "Anda menutup halaman pembayaran.");
      }
    });
  } else {
    showModal("error", "Error", result.message || "Terjadi kesalahan.");
  }
}
</script>

</body>
</html>
